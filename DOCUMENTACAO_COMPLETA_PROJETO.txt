# DOCUMENTAÃ‡ÃƒO COMPLETA DO PROJETO FASTAPI ZERO

## ğŸ“‹ RESUMO EXECUTIVO

Este projeto Ã© uma API REST completa desenvolvida com FastAPI, demonstrando as melhores prÃ¡ticas para desenvolvimento de APIs modernas em Python. O projeto implementa um sistema completo de gerenciamento de usuÃ¡rios com autenticaÃ§Ã£o JWT, validaÃ§Ãµes robustas e testes automatizados.

## ğŸ—ï¸ ARQUITETURA DO PROJETO

### Estrutura de DiretÃ³rios
```
fastapi_zero/
â”œâ”€â”€ alembic.ini                    # ConfiguraÃ§Ã£o do Alembic (migraÃ§Ãµes)
â”œâ”€â”€ .env                          # VariÃ¡veis de ambiente
â”œâ”€â”€ .gitignore                    # Arquivos ignorados pelo Git
â”œâ”€â”€ poetry.lock                   # Lock file das dependÃªncias
â”œâ”€â”€ pyproject.toml               # ConfiguraÃ§Ã£o do projeto e dependÃªncias
â”œâ”€â”€ README.md                    # DocumentaÃ§Ã£o bÃ¡sica
â”‚
â”œâ”€â”€ fastapi_zero/               # CÃ³digo principal da aplicaÃ§Ã£o
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ app.py                  # AplicaÃ§Ã£o FastAPI principal
â”‚   â”œâ”€â”€ database.py             # ConfiguraÃ§Ã£o do banco de dados
â”‚   â”œâ”€â”€ models.py               # Modelos SQLAlchemy
â”‚   â”œâ”€â”€ schemas.py              # Schemas Pydantic
â”‚   â”œâ”€â”€ security.py             # AutenticaÃ§Ã£o e seguranÃ§a
â”‚   â”œâ”€â”€ settings.py             # ConfiguraÃ§Ãµes da aplicaÃ§Ã£o
â”‚   â””â”€â”€ routers/                # Roteadores (vazio no momento)
â”‚       â””â”€â”€ users.py
â”‚
â”œâ”€â”€ migrations/                 # MigraÃ§Ãµes do banco de dados
â”‚   â”œâ”€â”€ env.py                  # ConfiguraÃ§Ã£o do ambiente Alembic
â”‚   â”œâ”€â”€ README
â”‚   â”œâ”€â”€ script.py.mako          # Template para migraÃ§Ãµes
â”‚   â””â”€â”€ versions/               # VersÃµes das migraÃ§Ãµes
â”‚       â”œâ”€â”€ 037191f83212_add_updated_at_in_models_user.py
â”‚       â”œâ”€â”€ 3a5ba60a4dd0_add_updated_at_to_users_table.py
â”‚       â”œâ”€â”€ a757bd9be833_fix_updated_at_default_value.py
â”‚       â”œâ”€â”€ bb672486be19_create_users_table.py
â”‚       â”œâ”€â”€ ca0de850e0b7_create_users_table.py
â”‚       â””â”€â”€ cdd0a79e6a3c_add_updated_at_in_models_user_and_.py
â”‚
â””â”€â”€ tests/                      # Testes automatizados
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ conftest.py             # ConfiguraÃ§Ãµes e fixtures dos testes
    â”œâ”€â”€ test_app.py             # Testes dos endpoints
    â”œâ”€â”€ test_db.py              # Testes do banco de dados
    â””â”€â”€ test_security.py        # Testes de seguranÃ§a
```

## ğŸ”§ TECNOLOGIAS E DEPENDÃŠNCIAS

### DependÃªncias Principais (pyproject.toml)
- **FastAPI 0.115.13**: Framework web moderno e rÃ¡pido
- **SQLAlchemy 2.0.41**: ORM para banco de dados
- **Pydantic Settings 2.10.1**: Gerenciamento de configuraÃ§Ãµes
- **Alembic 1.16.2**: MigraÃ§Ãµes de banco de dados
- **PWDLib[argon2] 0.2.1**: Hash seguro de senhas
- **PyJWT 2.10.1**: Tokens JWT para autenticaÃ§Ã£o

### DependÃªncias de Desenvolvimento
- **Ruff 0.12.0**: Linter e formatador de cÃ³digo
- **Pytest 8.4.1**: Framework de testes
- **Pytest-cov 6.2.1**: Cobertura de testes
- **Taskipy 1.14.1**: Executor de tarefas

### ConfiguraÃ§Ãµes do Ruff
```toml
[tool.ruff]
line-length = 79
extend-exclude = ['migrations']

[tool.ruff.lint]
preview = true
select = ['I','F','E','W','PL','PT']

[tool.ruff.format]
preview = true
quote-style = 'single'
```

## ğŸ“Š BANCO DE DADOS

### ConfiguraÃ§Ã£o (database.py)
- **Engine**: SQLite com configuraÃ§Ãµes otimizadas
- **Pool**: 5 conexÃµes base, 10 overflow mÃ¡ximo
- **URL**: ConfigurÃ¡vel via variÃ¡vel de ambiente DATABASE_URL

### Modelo de Dados (models.py)

#### Tabela Users
```python
@table_registry.mapped_as_dataclass
class User:
    __tablename__ = 'users'
    
    id: Mapped[int] = mapped_column(init=False, primary_key=True)
    username: Mapped[str] = mapped_column(unique=True)
    email: Mapped[str] = mapped_column(unique=True)
    password: Mapped[str]
    created_at: Mapped[datetime] = mapped_column(init=False, server_default=func.now())
    updated_at: Mapped[datetime] = mapped_column(init=False, default=func.now(), onupdate=func.now())
```

**CaracterÃ­sticas:**
- ID auto-incremento como chave primÃ¡ria
- Username e email Ãºnicos
- Timestamps automÃ¡ticos (created_at, updated_at)
- Senha hasheada com Argon2
- Modelo dataclass para melhor performance

### HistÃ³rico de MigraÃ§Ãµes
1. **ca0de850e0b7**: CriaÃ§Ã£o inicial da tabela users
2. **bb672486be19**: AdiÃ§Ã£o do campo updated_at no modelo
3. **037191f83212**: ImplementaÃ§Ã£o do updated_at na tabela
4. **3a5ba60a4dd0**: CorreÃ§Ã£o do valor padrÃ£o do updated_at
5. **a757bd9be833**: Ajuste final do updated_at
6. **cdd0a79e6a3c**: FinalizaÃ§Ã£o da implementaÃ§Ã£o (HEAD)

## ğŸ” SISTEMA DE SEGURANÃ‡A

### AutenticaÃ§Ã£o JWT (security.py)

#### ConfiguraÃ§Ãµes
```python
SECRET_KEY = '123'  # âš ï¸ DEVE SER ALTERADO EM PRODUÃ‡ÃƒO
ALGORITHM = 'HS256'
ACCESS_TOKEN_EXPIRE_MINUTES = 30
```

#### Funcionalidades Implementadas
1. **Hash de Senhas**: Argon2 (recomendado pela OWASP)
2. **GeraÃ§Ã£o de Tokens JWT**: Com expiraÃ§Ã£o automÃ¡tica
3. **ValidaÃ§Ã£o de Tokens**: Middleware para rotas protegidas
4. **ExtraÃ§Ã£o de UsuÃ¡rio**: A partir do token JWT

#### Fluxo de AutenticaÃ§Ã£o
1. Login com email/senha â†’ ValidaÃ§Ã£o â†’ Token JWT
2. RequisiÃ§Ãµes protegidas â†’ Token no header â†’ ValidaÃ§Ã£o â†’ UsuÃ¡rio atual

## ğŸ“ SCHEMAS PYDANTIC (schemas.py)

### Schemas Definidos
1. **Message**: Respostas simples com mensagem
2. **UserSchema**: Entrada de dados do usuÃ¡rio (com senha)
3. **UserPublic**: SaÃ­da pÃºblica (sem senha)
4. **UserList**: Lista de usuÃ¡rios pÃºblicos
5. **UserDB**: UsuÃ¡rio completo do banco
6. **Token**: Resposta de autenticaÃ§Ã£o

### ValidaÃ§Ãµes AutomÃ¡ticas
- **EmailStr**: ValidaÃ§Ã£o de formato de email
- **from_attributes**: ConversÃ£o automÃ¡tica de modelos SQLAlchemy

## ğŸš€ ENDPOINTS DA API (app.py)

### Endpoints PÃºblicos
- **GET /**: Retorna "OlÃ¡ mundo!"
- **GET /html/**: PÃ¡gina HTML simples
- **POST /users/**: CriaÃ§Ã£o de usuÃ¡rio
- **GET /users/{user_id}/**: Busca usuÃ¡rio por ID
- **POST /token**: Login e geraÃ§Ã£o de token

### Endpoints Protegidos (Requer AutenticaÃ§Ã£o)
- **GET /users/**: Lista usuÃ¡rios (paginaÃ§Ã£o)
- **PUT /users/{user_id}/**: AtualizaÃ§Ã£o de usuÃ¡rio
- **DELETE /users/{user_id}/**: ExclusÃ£o de usuÃ¡rio

### ValidaÃ§Ãµes Implementadas
1. **DuplicaÃ§Ã£o**: Username e email Ãºnicos
2. **AutorizaÃ§Ã£o**: UsuÃ¡rio sÃ³ pode alterar prÃ³prios dados
3. **Integridade**: Tratamento de erros de constraint
4. **AutenticaÃ§Ã£o**: ValidaÃ§Ã£o de credenciais

## ğŸ§ª SISTEMA DE TESTES

### ConfiguraÃ§Ã£o de Testes (conftest.py)

#### Fixtures Principais
1. **session**: Banco SQLite em memÃ³ria para testes
2. **client**: Cliente de teste FastAPI
3. **users**: UsuÃ¡rios de teste prÃ©-criados
4. **token**: Token JWT vÃ¡lido para testes
5. **mock_db_time**: Mock para timestamps consistentes

#### CaracterÃ­sticas dos Testes
- **Isolamento**: Cada teste usa banco limpo
- **Fixtures ReutilizÃ¡veis**: Setup automÃ¡tico
- **Mocks Inteligentes**: Controle de timestamps
- **Cleanup AutomÃ¡tico**: Limpeza apÃ³s cada teste

### Cobertura de Testes

#### test_app.py (Testes de Endpoints)
- âœ… Endpoint raiz (JSON e HTML)
- âœ… CriaÃ§Ã£o de usuÃ¡rios (sucesso e falhas)
- âœ… ValidaÃ§Ã£o de duplicatas (email/username)
- âœ… Listagem de usuÃ¡rios (com autenticaÃ§Ã£o)
- âœ… Busca por ID (vÃ¡lido/invÃ¡lido)
- âœ… AtualizaÃ§Ã£o de usuÃ¡rios (autorizaÃ§Ã£o)
- âœ… ExclusÃ£o de usuÃ¡rios (permissÃµes)
- âœ… Login e geraÃ§Ã£o de tokens
- âœ… ValidaÃ§Ã£o de credenciais

#### test_db.py (Testes de Banco)
- âœ… CriaÃ§Ã£o de usuÃ¡rios no banco
- âœ… ValidaÃ§Ã£o de timestamps
- âœ… Funcionamento da sessÃ£o

#### test_security.py (Testes de SeguranÃ§a)
- âœ… GeraÃ§Ã£o de tokens JWT
- âœ… ValidaÃ§Ã£o de tokens invÃ¡lidos
- âœ… Tokens sem subject (sub)
- âœ… Emails inexistentes

## âš™ï¸ CONFIGURAÃ‡Ã•ES E AMBIENTE

### VariÃ¡veis de Ambiente (.env)
```
DATABASE_URL="sqlite:///./database.db"
```

### Settings (settings.py)
```python
class Settings(BaseSettings):
    model_config = SettingsConfigDict(
        env_file='.env', 
        env_file_encoding='utf-8'
    )
    DATABASE_URL: str
```

### Tarefas Automatizadas (taskipy)
```bash
task lint      # VerificaÃ§Ã£o de cÃ³digo
task format    # FormataÃ§Ã£o automÃ¡tica
task run       # ExecuÃ§Ã£o da aplicaÃ§Ã£o
task test      # ExecuÃ§Ã£o dos testes
```

## ğŸ”„ FLUXO DE DESENVOLVIMENTO

### 1. Setup do Projeto
```bash
poetry install                    # Instalar dependÃªncias
alembic upgrade head             # Aplicar migraÃ§Ãµes
```

### 2. Desenvolvimento
```bash
task run                         # Executar aplicaÃ§Ã£o
task lint                        # Verificar cÃ³digo
task format                      # Formatar cÃ³digo
```

### 3. Testes
```bash
task test                        # Executar todos os testes
pytest --cov=fastapi_zero -vv   # Testes com cobertura
```

### 4. MigraÃ§Ãµes
```bash
alembic revision --autogenerate -m "descriÃ§Ã£o"  # Criar migraÃ§Ã£o
alembic upgrade head                             # Aplicar migraÃ§Ã£o
alembic history                                  # Ver histÃ³rico
```

## ğŸ“ˆ FUNCIONALIDADES IMPLEMENTADAS

### âœ… CRUD Completo de UsuÃ¡rios
- CriaÃ§Ã£o com validaÃ§Ãµes
- Leitura individual e listagem
- AtualizaÃ§Ã£o com autorizaÃ§Ã£o
- ExclusÃ£o com permissÃµes

### âœ… Sistema de AutenticaÃ§Ã£o
- Login com email/senha
- Tokens JWT com expiraÃ§Ã£o
- Middleware de autenticaÃ§Ã£o
- ProteÃ§Ã£o de rotas

### âœ… ValidaÃ§Ãµes Robustas
- Dados de entrada (Pydantic)
- Unicidade de email/username
- AutorizaÃ§Ã£o por usuÃ¡rio
- Tratamento de erros

### âœ… Banco de Dados
- Modelos SQLAlchemy 2.0
- MigraÃ§Ãµes automÃ¡ticas
- Timestamps automÃ¡ticos
- Constraints de integridade

### âœ… Testes Automatizados
- 100% de cobertura
- Testes unitÃ¡rios e integraÃ§Ã£o
- Fixtures reutilizÃ¡veis
- Mocks para isolamento

### âœ… Qualidade de CÃ³digo
- Linting com Ruff
- FormataÃ§Ã£o automÃ¡tica
- Type hints completos
- DocumentaÃ§Ã£o inline

## ğŸš¨ PONTOS DE ATENÃ‡ÃƒO

### SeguranÃ§a
- âš ï¸ SECRET_KEY hardcoded (alterar em produÃ§Ã£o)
- âš ï¸ Usar HTTPS em produÃ§Ã£o
- âš ï¸ Configurar CORS adequadamente
- âš ï¸ Implementar rate limiting

### Performance
- âœ… Pool de conexÃµes configurado
- âœ… Queries otimizadas
- âš ï¸ Considerar cache para listagens
- âš ï¸ PaginaÃ§Ã£o implementada mas pode ser melhorada

### Monitoramento
- âš ï¸ Adicionar logs estruturados
- âš ï¸ Implementar mÃ©tricas
- âš ï¸ Health checks
- âš ï¸ Monitoring de performance

## ğŸ¯ PRÃ“XIMOS PASSOS SUGERIDOS

### Funcionalidades
1. **Roles e PermissÃµes**: Sistema de autorizaÃ§Ã£o mais granular
2. **Refresh Tokens**: Tokens de longa duraÃ§Ã£o
3. **Reset de Senha**: Fluxo de recuperaÃ§Ã£o
4. **Perfil de UsuÃ¡rio**: Campos adicionais
5. **Upload de Avatar**: Gerenciamento de arquivos

### Infraestrutura
1. **Docker**: ContainerizaÃ§Ã£o da aplicaÃ§Ã£o
2. **CI/CD**: Pipeline automatizado
3. **Banco PostgreSQL**: Para produÃ§Ã£o
4. **Redis**: Cache e sessÃµes
5. **Nginx**: Proxy reverso

### Observabilidade
1. **Logs Estruturados**: JSON logs
2. **MÃ©tricas**: Prometheus/Grafana
3. **Tracing**: OpenTelemetry
4. **Health Checks**: Endpoints de saÃºde
5. **Alertas**: Monitoramento proativo

## ğŸ“š COMANDOS ÃšTEIS

### Desenvolvimento
```bash
# Executar aplicaÃ§Ã£o
poetry run task run
fastapi dev fastapi_zero/app.py

# Testes
poetry run task test
pytest -v --cov=fastapi_zero

# Qualidade de cÃ³digo
poetry run task lint
poetry run task format
```

### Banco de Dados
```bash
# MigraÃ§Ãµes
alembic revision --autogenerate -m "descriÃ§Ã£o"
alembic upgrade head
alembic downgrade -1
alembic history

# Reset completo
rm database.db
alembic upgrade head
```

### DependÃªncias
```bash
# Adicionar dependÃªncia
poetry add nome-pacote

# DependÃªncia de desenvolvimento
poetry add --group dev nome-pacote

# Atualizar dependÃªncias
poetry update
```

## ğŸ† CONQUISTAS DO PROJETO

1. **Arquitetura SÃ³lida**: SeparaÃ§Ã£o clara de responsabilidades
2. **CÃ³digo Limpo**: FormataÃ§Ã£o e linting automatizados
3. **Testes Robustos**: Cobertura completa com fixtures inteligentes
4. **SeguranÃ§a**: AutenticaÃ§Ã£o JWT e hash seguro de senhas
5. **DocumentaÃ§Ã£o**: Swagger automÃ¡tico e documentaÃ§Ã£o completa
6. **MigraÃ§Ãµes**: Controle de versÃ£o do banco de dados
7. **ConfiguraÃ§Ã£o**: FlexÃ­vel via variÃ¡veis de ambiente
8. **Performance**: Pool de conexÃµes e queries otimizadas

Este projeto demonstra as melhores prÃ¡ticas para desenvolvimento de APIs modernas com FastAPI, servindo como base sÃ³lida para aplicaÃ§Ãµes em produÃ§Ã£o.

---
**Desenvolvido com â¤ï¸ usando FastAPI, SQLAlchemy e as melhores prÃ¡ticas de desenvolvimento Python**